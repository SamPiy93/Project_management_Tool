<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My Profile</title>

       
      <link href="/login/js/assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="/login/js/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
        
    <!-- Custom styles for this template -->
    <link href="/login/js/assets/css/style.css" rel="stylesheet">
    <link href="/login/js/assets/css/style-responsive.css" rel="stylesheet"> 
    <link href="/login/css/dataTables.bootstrap.css" rel="stylesheet"> 
        
    </head>
<body>
  
    
    

        </div>
      </div>
    </div>
  </div>
    
  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      
      
      
      
      <!--header start-->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>Person Management</b></a>
            <!--logo end-->
            <div class="nav notify-row" id="top_menu">
                <!--  notification start -->
                <ul class="nav top-menu">
                    <!-- settings start -->
                    <li class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                            <i class="fa fa-tasks"></i>
                            <span class="badge bg-theme">4</span>
                        </a>
                        <ul class="dropdown-menu extended tasks-bar">
                            <div class="notify-arrow notify-arrow-green"></div>
                            <li>
                                <p class="green">You have 4 pending tasks</p>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <div class="task-info">
                                        <div class="desc">DashGum Admin Panel</div>
                                        <div class="percent">40%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <div class="task-info">
                                        <div class="desc">Database Update</div>
                                        <div class="percent">60%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <div class="task-info">
                                        <div class="desc">Product Development</div>
                                        <div class="percent">80%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <div class="task-info">
                                        <div class="desc">Payments Sent</div>
                                        <div class="percent">70%</div>
                                    </div>
                                    <div class="progress progress-striped">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%">
                                            <span class="sr-only">70% Complete (Important)</span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                            <li class="external">
                                <a href="#">See All Tasks</a>
                            </li>
                        </ul>
                    </li>
                    <!-- settings end -->
                    <!-- inbox dropdown start-->
                    <li id="header_inbox_bar" class="dropdown">
                        <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                            <i class="fa fa-envelope-o"></i>
                            <span class="badge bg-theme">5</span>
                        </a>
                        <ul class="dropdown-menu extended inbox">
                            <div class="notify-arrow notify-arrow-green"></div>
                            <li>
                                <p class="green">You have 5 new messages</p>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src="assets/img/ui-zac.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Zac Snider</span>
                                    <span class="time">Just now</span>
                                    </span>
                                    <span class="message">
                                        Hi mate, how is everything?
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src="assets/img/ui-divya.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Divya Manian</span>
                                    <span class="time">40 mins.</span>
                                    </span>
                                    <span class="message">
                                     Hi, I need your help with this.
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src="assets/img/ui-danro.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Dan Rogers</span>
                                    <span class="time">2 hrs.</span>
                                    </span>
                                    <span class="message">
                                        Love your new Dashboard.
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">
                                    <span class="photo"><img alt="avatar" src="assets/img/ui-sherman.jpg"></span>
                                    <span class="subject">
                                    <span class="from">Dj Sherman</span>
                                    <span class="time">4 hrs.</span>
                                    </span>
                                    <span class="message">
                                        Please, answer asap.
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="index.html#">See all messages</a>
                            </li>
                        </ul>
                    </li>
                    <!-- inbox dropdown end -->
                </ul>
                <!--  notification end -->
            </div>
            <div class="top-menu">
            	<ul class="nav pull-right top-menu">
                    <li><a class="logout" href="/login/index.php/login/login1"> <?php echo $_SESSION['NAME']; ?> Logout</a></li>
            	</ul>
            </div>
        </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
              
              	  <p class="centered">
                      
                      <?php if($_SESSION['NAME'] == 'Andrew Jayakodi') { ?>
                       <a href="profile.html"><img src="/login/css/Capture.JPG" class="img-circle"  ></a></p>
              	  <h5 class="centered">Andrew Jayakodi</h5>
                      
                      <?php  }else{ ?>
                      
                       <a href="profile.html"><img src="<?php  echo $_SESSION['IMG'];  ?>" class="img-circle img-responsive"  style="height:100px;align:center;margin-left:25%"></a></p>
              	  <h5 class="centered"><?php echo $_SESSION['NAME']; ?></h5>
                      
                      <?php  } ?>
                     
              	  	
                  <li class="mt active">
                      <a  href="/login/index.php/person/adminindex">
                          <i class="fa fa-dashboard"></i>
                  <span>Manage Members </span></a></li>
                <li class="mt active">  
                    <a onclick="edit_person('<?php  echo $_SESSION['ID'];  ?>')" href="#">
                  <i class="fa fa-dashboard"></i>
                  <span>My Profile </span>
                </a></li>
                 <li class="mt active">  
                    <a  href="/login/index.php/person/adminlogs">
                  <i class="fa fa-dashboard"></i>
                  <span>Login logs </span>
                </a></li>
              

                 
              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
    
    
    
     <section id="main-content">
          <section class="wrapper site-min-height">
          	<h3>  Persons</h3>
            
            <br />
        <button class="btn btn-success" onclick="add_person()"><i class="glyphicon glyphicon-plus"></i> Add Person</button>
        <button class="btn btn-default" onclick="reload_table()"><i class="glyphicon glyphicon-refresh"></i> Reload</button>
        <br />
           
          	<div class="row mt">
          		<div class="col-lg-12">
          		<div class="">
     
                <table class="table table-striped table-bordered table-hover dataTables-example" id="hh" plugin="datatable" >
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Login time</th>
                        

                  </tr>
                </thead>
                <tbody>


                </tbody>

            </table>

    
    
    
    
    </div>
 
          		</div>
          	</div>
			
         </section>
      </section>
 
     
    
    
    <script src="/login/js/assets/js/jquery.js"></script>
    <script src="/login/js/assets/js/bootstrap.min.js"></script>
    <script src="/login/js/assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="/login/js/assets/js/jquery.ui.touch-punch.min.js"></script>
    <script class="include" type="text/javascript" src="/login/js/assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="/login/js/assets/js/jquery.scrollTo.min.js"></script>
    <script src="/login/js/assets/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="/login/js/jquery.dataTables.js"></script>
    
    
    
    <script>
    
	
	
     $('document').ready(function(){
      loadData();
     });
        
        
        
    function loadData(){
        
        var oTable = $('#hh').DataTable();
        oTable.destroy();

        $('#hh').DataTable( {
        "ajax": "getloginlog",
        "columns": [
                    { "data": "username" },
                    { "data": "lastlogintime" }   
                   ]
            } );
        
    }
	
    function add_person(){
     save_method = 'add';
     $('#form')[0].reset(); // reset form on modals
     $('.form-group').removeClass('has-error'); // clear error class
     $('.help-block').empty(); // clear error string
     $('#modal_form').modal('show'); // show bootstrap modal
     $('.modal-title').text('Add Person'); // Set Title to Bootstrap modal title
    }
	
	
    function changestatus(id, stattochange){
        $.ajax({
            url:"changeuserstatus",
            type:"post",
            data:{
                id1:id,
                state1: stattochange
            },
            success:function(data){
               // alert("Deleted");
                loadData(); 
            },
           
			
            error: function (jqXHR, textStatus, errorThrown){
                alert('Error changing status');
            }

        });
    }
	
    
    function del(id){
        
        $.ajax({
            url:"deletepeople",
            type:"post",
            data:{
                id123:id
            },
            success:function(data){
               // alert("Deleted");
                loadData(); 
            },
           
			
	    error: function (jqXHR, textStatus, errorThrown){
                alert('Error deleting data');
            }    
        });  
    }
	
    function edit_person(id){
     save_method = 'update';
     $('#form')[0].reset(); // reset form on modals
     $('.form-group').removeClass('has-error'); // clear error class
     $('.help-block').empty(); // clear error string
 
     //Ajax Load data from ajax
     $.ajax({
        url : "<?php echo site_url('person/ajax_edit/')?>/" + id,
        type: "GET",
        dataType: "JSON",
        success: function(data){
 
            $('[name="id"]').val(data.id);
            $('[name="username"]').val(data.username);
            $('[name="first_name"]').val(data.first_name);
            $('[name="last_name"]').val(data.last_name);
            $('[name="email"]').val(data.email);
           // $('[name="dob"]').datepicker('update',data.dob);
            $('#modal_form').modal('show'); // show bootstrap modal when complete loaded
            $('.modal-title').text('Edit Person'); // Set title to Bootstrap modal title
 
        },
        error: function (jqXHR, textStatus, errorThrown){
            alert('Error get data from ajax');
        }
     });
    }

    function reload_table(){
     table.ajax.reload(null,false); //reload datatable ajax
    }
	
	
    function save(){
     $('#btnSave').text('saving...'); //change button text
     $('#btnSave').attr('disabled',true); //set button disable
     var url;
 
     if(save_method == 'add'){
        url = "<?php echo site_url('person/ajax_add')?>";
     } 
     else{
        url = "<?php echo site_url('person/ajax_update')?>";
     }
 
     // ajax adding data to database
     $.ajax({
        url : url,
        type: "POST",
        data: $('#form').serialize(),
        dataType: "JSON",
        success: function(data){
 
            if(data.status){ //if success close modal and reload ajax table
                $('#modal_form').modal('hide');
                reload_table();
            }
            else{
                for (var i = 0; i < data.inputerror.length; i++)
                {
                    $('[name="'+data.inputerror[i]+'"]').parent().parent().addClass('has-error'); //select parent twice to select div form-group class and add has-error class
                    $('[name="'+data.inputerror[i]+'"]').next().text(data.error_string[i]); //select span help-block class set text error string
                }
            }
            $('#btnSave').text('save'); //change button text
            $('#btnSave').attr('disabled',false); //set button enable
 
 
        },
        error: function (jqXHR, textStatus, errorThrown){
            alert('Error adding / update data');
            $('#btnSave').text('save'); //change button text
            $('#btnSave').attr('disabled',false); //set button enable
 
        }
     });
    }


    
    </script>
<!-- Bootstrap modal -->    
    <div class="modal fade" id="modal_form" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title">Person Form</h3>
            </div>
            <div class="modal-body form">
                <form action="#" id="form" class="form-horizontal">
                    <input type="hidden" value="" name="id"/>
                    <div class="form-body">
                        <div class="form-group">
                          <label class="control-label col-md-3">User Name</label>
                          <div class="col-md-9">
                            <input name="username" placeholder="User Name" class="form-control" type="text">
                                <span class="help-block"></span>
                          </div>
                        </div>
                        
                        <div class="form-group">
                          <label class="control-label col-md-3">Password</label>
                        <div class="col-md-6">
        
      <input type="password" id="password" name="password" placeholder="Enter Password" class="form-control" required>
    
        </div>
                        </div>
                        
                        
                        <div class="form-group">
                          <label class="control-label col-md-3">   First Name</label>
                          <div class="col-md-9">
                                <input name="first_name" placeholder="First Name" class="form-control" type="text">
                                <span class="help-block"></span>
                          </div>
                        </div>
                        
                        
                     <div class="form-group">
                          <label class="control-label col-md-3">Last Name</label>
                          <div class="col-md-9">
                                <input name="last_name" placeholder="Last Name" class="form-control" type="text">
                                <span class="help-block"></span>
                       </div>
                      </div>
                        
                      <div class="form-group">
                          <label class="control-label col-md-3">Email</label>
                          <div class="col-md-6">
            
    <input type="email" id="email" name="email" placeholder="Enter Email" class="form-control" required >
  </div>
                        </div>
                        
                        <div class="form-group">
                          <label class="control-label col-md-3">Type</label>
                          <div class="col-md-9">
                                <input name="type" placeholder="Type" class="form-control" type="text">
                                <span class="help-block"></span>
                       </div>
                      </div>
                        
                      
                        <div class="form-group">
                          <div class="col-md-9"><span class="help-block"></span>
                            </div>
                      </div>
                        <div class="form-group">
                            
                            <div class="col-md-9"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="btnSave" onclick="save()" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- End Bootstrap modal -->
    
</body>
</html>